"use strict";(self.webpackChunkgrata_excel_addin=self.webpackChunkgrata_excel_addin||[]).push([[12],{23713:function(e,t,n){n.d(t,{createRumProfiler:function(){return b}});var s=n(80886),r=n(29336),o=n(30194),i=n(42182),a=n(32234),c=n(93001),u=n(28448);const l=new Map;function d(e){return l.get(e)}function f(e){for(const t of l.keys())t<e&&l.delete(t)}function p({rawRumEvent:e,startTime:t}){if(e.type!==u.bb.LONG_TASK)return;!function(e,t){l.set(t,e)}(e.long_task.id,t)}const m=/\/(?![vV]\d{1,2}\/)([^/\d?]*\d+[^/?]*)/g;const v=(e,t)=>e||function(e){return e?e.replace(m,"/?"):"/"}(t);var g=n(62360);function w(e,t,n){const s={application:{id:t}};n&&(s.session={id:n});const{ids:r,names:o}=function(e){const t={ids:[],names:[]};for(const n of e)t.ids.push(n.viewId),n.viewName&&t.names.push(n.viewName);return t.names=Array.from(new Set(t.names)),t}(e.views);r.length&&(s.view={id:r,name:o});const i=e.longTasks.map(e=>e.id).filter(e=>void 0!==e);return i.length&&(s.long_task={id:i}),s}function h(e,t,n){const s=function(e,t,n){const s=(0,g.m5)(t),o=w(e,t.applicationId,n),i=function(e){const t=e.concat(["language:javascript","runtime:chrome","family:chrome","host:browser"]);return t}(s),a={...o,attachments:["wall-time.json"],start:new Date(e.startClocks.timeStamp).toISOString(),end:new Date(e.endClocks.timeStamp).toISOString(),family:"chrome",runtime:"chrome",format:"json",version:4,tags_profiler:i.join(","),_dd:{clock_drift:(0,r.TP)()}};return a}(e,t,n);return{event:s,"wall-time.json":e}}const k={sampleIntervalMs:10,collectIntervalMs:6e4,minProfileDurationMs:5e3,minNumberOfSamples:50};function b(e,t,n,l,m,g=k){const w=(0,u.wP)(e,t,m,6),b=(0,u.s5)(u.do.LONG_ANIMATION_FRAME);let y;const T=[];let I={state:"stopped"};function M(){const n=(0,o.VZ)().Profiler;if(!n)throw l.set({status:"error",error_reason:"not-supported-by-browser"}),new Error("RUM Profiler is not supported in this browser.");_(I).catch(i.Dx);const{cleanupTasks:s,observer:u}=function(n){if("running"===n.state)return{cleanupTasks:n.cleanupTasks,observer:n.observer};const s=[];let r;if(e.trackLongTasks){r=new PerformanceObserver(P),r.observe({entryTypes:[b?"long-animation-frame":"longtask"]});const e=t.subscribe(12,e=>{p(e)});s.push(()=>null==r?void 0:r.disconnect()),s.push(e.unsubscribe)}const o=t.subscribe(2,e=>{const t={viewId:e.id,viewName:v(e.name,document.location.pathname),startClocks:e.startClocks};C(t),y=t});return s.push(o.unsubscribe),{cleanupTasks:s,observer:r}}(I);let d;try{d=new n({sampleInterval:g.sampleIntervalMs,maxBufferSize:Math.round(1.5*g.collectIntervalMs/g.sampleIntervalMs)})}catch(e){return void(e instanceof Error&&e.message.includes("disabled by Document Policy")?(a.Vy.warn("[DD_RUM] Profiler startup failed. Ensure your server includes the `Document-Policy: js-profiling` response header when serving HTML pages.",e),l.set({status:"error",error_reason:"missing-document-policy-header"})):l.set({status:"error",error_reason:"unexpected-exception"}))}l.set({status:"running",error_reason:void 0}),I={state:"running",startClocks:(0,r.M8)(),profiler:d,timeoutId:(0,c.wg)(M,g.collectIntervalMs),longTasks:[],views:[],cleanupTasks:s,observer:u},C(y),d.addEventListener("samplebufferfull",D)}async function _(t){var s,o;if("running"!==t.state)return;O(null!==(o=null===(s=t.observer)||void 0===s?void 0:s.takeRecords())&&void 0!==o?o:[]),(0,c.DJ)(t.timeoutId),t.profiler.removeEventListener("samplebufferfull",D);const{startClocks:a,longTasks:u,views:l}=t,d=(0,r.M8)();await t.profiler.stop().then(t=>{const s=(0,r.M8)(),o=u.length>0,i=(0,r.vk)(a.timeStamp,s.timeStamp)<g.minProfileDurationMs,c=function(e){let t=0;for(const n of e)void 0!==n.stackId&&t++;return t}(t.samples)<g.minNumberOfSamples;(o||!i&&!c)&&(!function(t){var s;const r=null===(s=n.findTrackedSession())||void 0===s?void 0:s.id,o=h(t,e,r);w.send(o)}(Object.assign(t,{startClocks:a,endClocks:s,clocksOrigin:(0,r.Oc)(),longTasks:u,views:l,sampleInterval:g.sampleIntervalMs})),f(d.relative))}).catch(i.Dx)}async function S(e){"running"===I.state&&(I.cleanupTasks.forEach(e=>e()),await _(I),I={state:e})}function C(e){"running"===I.state&&e&&I.views.push(e)}function D(){M()}function P(e){O(e.getEntries())}function O(e){if("running"===I.state)for(const t of e){if(t.duration<g.sampleIntervalMs)continue;const e=(0,r.FR)(t.startTime),n=d(e.relative);I.longTasks.push({id:n,duration:t.duration,entryType:t.entryType,startClocks:e})}}function E(){"hidden"===document.visibilityState&&"running"===I.state?S("paused").catch(i.Dx):"visible"===document.visibilityState&&"paused"===I.state&&M()}function N(){M()}return{start:function(t){"running"!==I.state&&(y=t?{startClocks:t.startClocks,viewId:t.id,viewName:v(t.name,document.location.pathname)}:void 0,T.push((0,s.q)(e,window,"visibilitychange",E).stop,(0,s.q)(e,window,"beforeunload",N).stop),M())},stop:async function(){await S("stopped"),T.forEach(e=>e()),f((0,r.M8)().relative),l.set({status:"stopped",error_reason:void 0})},isStopped:function(){return"stopped"===I.state},isRunning:function(){return"running"===I.state},isPaused:function(){return"paused"===I.state}}}}}]);